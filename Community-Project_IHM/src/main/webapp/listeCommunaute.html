<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
  <title>Community-Project</title>

  <!-- CSS  -->
  <link href="./service_files/icon" rel="stylesheet">
  <link href="./service_files/materialize.css" type="text/css" rel="stylesheet" media="screen,projection">
  <link href="./service_files/style.css" type="text/css" rel="stylesheet" media="screen,projection">
  <style>
	#map {
	width: 400px;
	height: 300px;
	background-color: grey;
	}
</style>
</head>
<body>
<nav>
    <div class="nav-wrapper teal lighten-2">
      <a href="#!" class="brand-logo">&nbsp;&nbsp;&nbsp;&nbsp;Community Project</a>
      <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
      <ul class="right hide-on-med-and-down">
        <li><a href="acceuilConnecte.html">Accueil</a></li>
        <li><a href="demandeService.html">Demander un service</a></li>
        <li><a href="listeService.html">Proposer de l'aide</a></li>
        <li><a href="listeCommunaute.html">Communautés</a></li>
        <li><a href="profil.html">Profil</a></li>
        <li><a onclick="disconnect()">Déconnexion</a></li>
      </ul>
      <ul class="side-nav" id="mobile-demo">
        <li><a href="acceuilConnecte.html">Accueil</a></li>
        <li><a href="demandeService.html">Demander un service</a></li>
        <li><a href="listeService.html">Proposer de l'aide</a></li>
        <li><a href="listeCommunaute.html">Communautés</a></li>
        <li><a href="profil.html">Profil</a></li>
        <li><a onclick="disconnect()">Déconnexion</a></li>
      </ul>
    </div>
  </nav>
	
  <div class="parallax-container valign-wrapper">
    <div class="section no-pad-bot">
      <div class="container">
        <div class="row center">
          <h2 class="header center white-text text-lighten-2" style="text-shadow: #000000 1px 1px, #000000 -1px 1px, #000000 -1px -1px, #000000 1px -1px;">Consulter et rechercher des communautés</h2>
        </div>
        <div class="row center">
          <a href="creationCommunaute.html" id="creer-communaute" class="btn-large waves-effect waves-light teal lighten-1">Créer une communauté</a>
        </div>
      </div>
    </div>
    <div class="parallax"><img src="backgrounds/background10.jpg" alt="Unsplashed background img 2"></div>
  </div>
  <br/>
  <div class="row center">
    <h4 class="teal-text text-lighten-1"> Recherche de communautés</h4>
  </div>
  <div class="row center">
          <div class="input-field inline">
            <select id="filtre">
                <option value="recherche_nom">Recherche par nom</option>
                <option value="recherche_ville">Recherche par ville</option>
            </select>
          </div>
  </div>
  
    <div class="row center">
        <div class="col s4"></div>
        <div class="col s4">
            <form>
                <div class="input-field">
                    <input id="text_saisie" type="search" required> 
                    <label class="label-icon" for="rechercheVille"><i class="material-icons">search</i></label>
                    <i class="material-icons">close</i>
                </div>
            </form>
        </div>
        <div class="col s4"></div>
    </div>
  <div class="row center">
        <a onclick="rechercher()" class="waves-effect waves-light btn">rechercher</a>				
    </div>
    <!--
    <div class="col s3">
        <h6> Recherche par ville:</h6>
        <form>
            <div class="input-field">
                <input id="rechercheVille" type="search" required> 
                <label class="label-icon" for="rechercheVille"><i class="material-icons">search</i></label>
                <i class="material-icons">close</i>
            </div>
        </form>
    </div>
    -->
  <div class="row">
      <div class="col s3"></div>
      <div class="col s6">
        <label  id ="search2"></label>
        <div id="communautes_recherchees" class="collection">
          <a href="#rejoindre" class="collection-item">AS Insa Lyon</a>
          <a href="#rejoindre" class="collection-item">Association Objectif 21</a>
          <a href="#rejoindre" class="collection-item">Association Musiqu'Art</a>
          <a href="#rejoindre" class="collection-item">Abercrombie Bvd</a>
          <a href="#rejoindre" class="collection-item">Astoria Communauté</a>
        </div>
    </div>
    <div class="col s3"></div>
    <!--
    <div class="col s4">
      <label  id ="search2"></label>
      <div class="collection">
        <a href="#rejoindre" class="collection-item">AS Insa Lyon</a>
        <a href="#rejoindre" class="collection-item">Association Objectif 21</a>
        <a href="#rejoindre" class="collection-item">Centre Bayard</a>
        <a href="#rejoindre" class="collection-item">Immeuble La Doua</a>
      </div>  
    </div>
    -->
    <div class="col s1"></div>
  </div>
  <div id="rejoindre" class="modal">
    <div class="modal-content">
      <h4>Rejoindre une communauté</h4>
      <p>Souhaitez-vous rejoindre la communauté "NOM_COMMUNAUTE" ?</p>
      <div class="modal-footer">
        <a class="modal-action modal-close waves-effect waves-green btn-flat">Annuler</a>
        <a id="rejoindre_communaute" class="btn-flat">Rejoindre</a>
      </div>
  </div>
  </div>
  <hr/>
  <div class="row center">
    <h4 class="teal-text text-lighten-1"> Mes communautés</h4>
  </div>
  <div class="row">
              <div class="col s6"> Communautés où je suis inscrit:     
                  <label  id ="comm1"></label>
                    <ul id="communautes_inscrit" class="collection">
                        <font color="teal"><li class="collection-item">
                        AS Insa Lyon<br/></font><a href="communaute.html" class="secondary-content"><i class="small material-icons">search</i></a><br/>
                        <i class="tiny material-icons">call_made</i>Jetons offerts: 4  | 
                        <i class="tiny material-icons">call_received</i> Jetons reçus: 4  | 
                        <font color="red"> <i class="tiny material-icons">stars</i> Total jetons: 2</font>
                        </li>
                        <font color="teal"><li class="collection-item">
                        Centre Bayard<br/></font><a href="communaute.html" class="secondary-content"><i class="small material-icons">search</i></a><br/>
                        <i class="tiny material-icons">call_made</i>Jetons offerts: 4  | 
                        <i class="tiny material-icons">call_received</i> Jetons reçus: 4  | 
                        <font color="red"> <i class="tiny material-icons">stars</i> Total jetons: 2</font>
                        </li>
                        <font color="teal"><li class="collection-item">
                        Immeuble La Doua<br/></font><a href="communaute.html" class="secondary-content"><i class="small material-icons">search</i></a><br/>
                        <i class="tiny material-icons">call_made</i>Jetons offerts: 4  | 
                        <i class="tiny material-icons">call_received</i> Jetons reçus: 4  | 
                        <font color="red"> <i class="tiny material-icons">stars</i> Total jetons: 2</font>
                        </li>
                    </ul>
              </div>
              <div class="col s6">  Communautés que j'ai créées:
                  <label  id ="comm2"></label>    
                    <ul id="communautes_cree" class="collection">
                        <font color="teal"><li class="collection-item">
                        AS Insa Lyon<br/></font><a href="communaute.html" class="secondary-content"><i class="small material-icons">mode_edit</i></a><br/>
                        <i class="tiny material-icons">call_made</i>Jetons offerts: 4  | 
                        <i class="tiny material-icons">call_received</i> Jetons reçus: 4  | 
                        <font color="red"> <i class="tiny material-icons">stars</i> Total jetons: 2</font>
                        </li>
                        <font color="teal"><li class="collection-item">
                        Centre Bayard<br/></font><a href="communaute.html" class="secondary-content"><i class="small material-icons">mode_edit</i></a><br/>
                        <i class="tiny material-icons">call_made</i>Jetons offerts: 4  | 
                        <i class="tiny material-icons">call_received</i> Jetons reçus: 4  | 
                        <font color="red"> <i class="tiny material-icons">stars</i> Total jetons: 2</font>
                        </li>
                    </ul>
              </div>
          </div>
        </div>
      </div>
	<div class="row center">
		<a href="creationCommunaute.html" class="waves-effect waves-light btn">Créer une communauté</a>				
	</div>
</div>

    <div class="parallax-container valign-wrapper">
    <div class="section no-pad-bot">
      <div class="container">
        <div class="row center">
          <h4 class=" col s12 light white-text text-lighten-2" style="text-shadow: #000000 1px 1px, #000000 -1px 1px, #000000 -1px -1px, #000000 1px -1px;">Bricolage // Jardinage // Education // Informatique // Réparations // Et bien plus encore...</h4>
        </div>
      </div>
    </div>
    <div class="parallax"><img src="backgrounds/background9.jpg" alt="Unsplashed background img 2"></div>
  </div>

  <footer class="page-footer teal">
    <div class="container">
      <div class="row center">
        <div class="col s12">
          <h5 class="white-text">Qui sommes nous?</h5>
          <p class="grey-text text-lighten-4">Une équipe formée par des élèves ingénieurs et le Grand Lyon. Notre but commun: permettre l'amélioration de la vie communautaire dans Lyon, et veiller au bien-être de ses citoyens. Nous encourageons le partage, l'entraide, et la bienveillance.</p>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      Réalisé par des élèves de l'<a class="brown-text text-lighten-3" href="https://www.insa-lyon.fr/">INSA Lyon</a>
      </div>
    </div>
  </footer>
  <style>
    .parallax-container {
        height: 450px;
      }
    </style>


  <!--  Scripts-->
  <script src="./service_files/jquery-2.1.1.min.js.download"></script>
  <script src="./service_files/materialize.js.download"></script>
  <script src="./service_files/init.js.download"></script>
	<script>
  $(document).ready(function(){
    // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
    $('.modal').modal();
  });
  </script>
  <script>
    $(document).ready(function() {
        $('select').material_select();
        $("#communautes_recherchees").empty().html('');
    });
  </script>

    <script>
        $(document).ready(function() {
            $.ajax({
            url : './MainServlet',
            type : 'POST',
            dataType : 'json',
            data: { action: "recuperer_communautes",},
            success : function(data){
                if(data.response == "403"){
                    $("#communautes_inscrit").empty().html('');
                    $("#communautes_cree").empty().html('');
                }
                
            },
            error: function (jqXHR, textStatus, errorThrown) {
                // alert(jqXHR + " | " +textStatus + " | " +errorThrown);
            }
        });
        });
    </script>
  
<script>
    function preloadFunc() {
        $.ajax({
            url : './MainServlet',
            type : 'POST',
            dataType : 'json',
            data: { action: "check_permission",},
            success : function(data){
                if(data.response == "401")
                    document.location.href="needConnection.html";
            },
            error: function (jqXHR, textStatus, errorThrown) {
                // alert(jqXHR + " | " +textStatus + " | " +errorThrown);
            }
        });
    }
    window.onpaint = preloadFunc();
  </script>
  
    <script>
        function rechercher() {
            if($("#filtre").val() == "recherche_ville") {
                $.ajax({
                    url : './MainServlet',
                    type : 'POST',
                    dataType : 'json',
                    data: { action: "rechercher_communaute_par_ville",
                            ville: $("#text_saisie").val()
                          },
                    success : function(data){
                        if(data.response == "403"){
                            $("#communautes_recherchees").empty().html('');
                            alert("Pas de communauté dans cette ville");
                        }
                        else{
                            $("#communautes_recherchees").empty().html('');
                            for (var i=0; i<Object.keys(data).length; i++)
                                $('#communautes_recherchees').append($("<a></a>").attr("href","communaute.html").attr("class","collection-item").text(Object.keys(data)[i]));
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert(jqXHR + " | " +textStatus + " | " +errorThrown);
                    }
                });
            }
            else {
                $.ajax({
                    url : './MainServlet',
                    type : 'POST',
                    dataType : 'json',
                    data: { action: "rechercher_communaute_par_nom",
                            nom: $("#text_saisie").val()
                          },
                    success : function(data){
                        if(data.response == "403"){
                            $("#communautes_recherchees").empty().html('');
                            alert("Pas de communauté ayant ce nom");
                        }
                        else{
                            $("#communautes_recherchees").empty().html('');
                            $('#communautes_recherchees').append($("<a></a>").attr("href","communaute.html").attr("class","collection-item").text(Object.keys(data)[0]));
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        // alert(jqXHR + " | " +textStatus + " | " +errorThrown);
                    }
                });
            }
        }
    </script>
  
  <script>
    function disconnect() {
        $.ajax({
            url : './MainServlet',
            type : 'POST',
            dataType : 'json',
            data: { action: "disconnect",},
            success : function(data){
                if(data.response == "200")
                    document.location.href="index.html";
            },
            error: function (jqXHR, textStatus, errorThrown) {
                // alert(jqXHR + " | " +textStatus + " | " +errorThrown);
            }
        });
    }
  </script>
  
  <style>
	#map {
	width: 100%;
	height: 200px;
	background-color: grey;
	}
</style>
<div class="hiddendiv common"></div><div class="drag-target" data-sidenav="mobile-demo" style="left: 0px; touch-action: pan-y; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></div></body></html>